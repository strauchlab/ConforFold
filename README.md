# ConforFold

**Deep learning model grenerating protein conformational ensembles**





\
ConforFold is a retrained version of OpenFold which generates protein conformational ensembles based on additional protein secondary structure prediction (PSSP) inputs. PSSP sequences can be generated by means of ConforPSSP, which can be found in our GitHub repository.
\
\
ConforFold is available under the [Apache License, Version 2.0](http://www.apache.org/licenses/LICENSE-2.0), silimar to OpenFold.



# Installation on Linux

1. Install OpenFold according to instructions in [Setting Up OpenFold](https://openfold.readthedocs.io/en/latest/Installation.html#).
   Make sure that the installation is successful.

2. Download ConforFold repository using git.
   git clone git://project.url.here

3. Replace the following files with the corresponding files from conffold folder in ConforFold repository: <br />
	..path_to_OpenFold/openfold/config.py <br />
	..path_to_OpenFold/oopenfold/np/residue_constants.py <br />
	..path_to_OpenFold/oopenfold/utils/trace_utils.py <br />
	..path_to_OpenFold/oopenfold/utils/script_utils.py <br />
	..path_to_OpenFold/oopenfold/model/embedders.py <br />
	..path_to_OpenFold/oopenfold/data/data_transforms.py <br />
	..path_to_OpenFold/oopenfold/data/feature_pipeline.py <br />
	..path_to_OpenFold/oopenfold/data/data_pipeline.py 




# Run the test case

1. Change the working directory to ConforFold:
	cd ConforFold

2. Run the test case:
```
    python3 run_pretrained_openfold.py \
        $INPUT_FASTA_DIR \
        $TEMPLATE_MMCIF_DIR 
        --output_dir $OUTPUT_DIR \
        --config_preset model_3_ptm \
        --uniref90_database_path $BASE_DATA_DIR/uniref90 \
        --mgnify_database_path $BASE_DATA_DIR/mgnify/mgy_clusters_2018_12.fa \
        --pdb70_database_path $BASE_DATA_DIR/pdb70 \
        --uniclust30_database_path $BASE_DATA_DIR/uniclust30/uniclust30_2018_08/uniclust30_2018_08 \
        --bfd_database_path $BASE_DATA_DIR/bfd/bfd_metaclust_clu_complete_id30_c90_final_seq.sorted_opt \
        --model_device "cuda:0" 
        --openfold_checkpoint_path $MODEL_PATH \
        --pssp_fasta
```
\
\
**Required arguments:**
<br />
	  --output_dir: Specify the output directory. <br />
	  $INPUT_FASTA_DIR: Directory of query fasta file and PSSP for the query, one query per input, e.g. test/1cll_A. <br />
	  $TEMPLATE_MMCIF_DIR: MMCIF files to use for template matching. This directory is required even if using template free inference. <br />
	  $MODEL_PATH: Path to ConforFold model, e.g. model/conforfold_model.pt. <br />
	  *_database_path: Paths to sequence databases for sequence alignment. <br />
	  --model_device: Specify to use a GPU if one is available. 



